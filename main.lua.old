-- Copyright (C) 2024 frityet
-- 
-- This program is free software: you can redistribute it and/or modify
-- it under the terms of the GNU Affero General Public License as
-- published by the Free Software Foundation, either version 3 of the
-- License, or (at your option) any later version.
-- 
-- This program is distributed in the hope that it will be useful,
-- but WITHOUT ANY WARRANTY; without even the implied warranty of
-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-- GNU Affero General Public License for more details.
-- 
-- You should have received a copy of the GNU Affero General Public License
-- along with this program.  If not, see <https://www.gnu.org/licenses/>.

local extension = jit.os == "Windows" and "dll" or jit.os == "OSX" and "dylib" or "so"
package.cpath = string.format("%s;./cimgui/native/?.%s", package.cpath, extension)

local imgui = require("cimgui")
local pages = require("pages")
local utilities = require("utilities")

local current_index = 1

function love.load()
    imgui.love.Init()
    love.window.setTitle("Lua Workshop")
    love.window.setMode(0, 0, {fullscreen = true})
end

function love.draw()
    local pg = pages[current_index]
    love.graphics.setBackgroundColor(1, 1, 1)

    love.graphics.setColor(0, 0, 0)
    love.graphics.setFont(utilities.load_font(72))
    love.graphics.print(pg.title, 10, 10)
    love.graphics.setFont(utilities.load_font(24))
    pg.on_draw()
    imgui.Render()
    imgui.love.RenderDrawLists()
end

function love.update(dt)
    imgui.love.Update(dt)
    imgui.NewFrame()
end

---@param key love.KeyConstant
function love.keypressed(key)
    if key == "right" then
        print("Next page")
        local pg = pages[current_index]

        if not pg.on_next or pg.on_next() then
            current_index = current_index + 1
            if current_index > #pages then
                current_index = 1
            end
        end
    elseif key == "left" then
        print("Previous page")
        current_index = current_index - 1
        if current_index < 1 then
            current_index = #pages
        end
    end
end

function love.quit()
    imgui.love.Shutdown()
end
